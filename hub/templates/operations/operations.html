{% extends "base.html" %}

{% block title %}Operations{% endblock %}

{% block sidebar %}
  {% include "partials/sidebar.html" %}
{% endblock %}

{% block content %}
<section class="section">
  <div class="operations-header">
    <div>
      <h2>Observatory Operations</h2>
      <p class="operations-meta">
        Checklist state is shared across all signed-in users.
      </p>
    </div>
    <div class="operations-meta">
      <div>Signed in as {{ request.user.get_username }}</div>
      <a href="{% url 'logout' %}" class="secondary">Log out</a>
    </div>
  </div>

  {% if messages %}
    {% for message in messages %}
      <article class="operations-card">{{ message }}</article>
    {% endfor %}
  {% endif %}

  <article class="operations-card">
    <strong>Observatory state:</strong> {{ state_label }}
    <div class="operations-meta">
      {% if state.last_action %}
        Last action: {{ state.action_label }} ({{ state.action_status_label }})
        {% if state.last_action_at %} Â· {{ state.last_action_at|date:"Y-m-d H:i" }}{% endif %}
        {% if state.last_action_by %} by {{ state.last_action_by.get_username }}{% endif %}
      {% else %}
        No actions recorded yet.
      {% endif %}
    </div>
    {% if state.last_action_message %}
      <div class="operations-meta">{{ state.last_action_message }}</div>
    {% endif %}
    {% if state.updated_at %}
      <div class="operations-meta">
        Checklist updated {{ state.updated_at|date:"Y-m-d H:i" }}
        {% if state.updated_by %}by {{ state.updated_by.get_username }}{% endif %}
      </div>
    {% endif %}
  </article>
</section>

<div id="operations-dynamic">
  {% include "operations/_checklist.html" %}
</div>
{% endblock %}

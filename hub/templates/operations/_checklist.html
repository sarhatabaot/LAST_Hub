<section class="section">
  <h3>Operational Checklist</h3>
  <div class="checklist">
    {% for item in checklist_items %}
      {% if request.user.is_authenticated %}
        <form
          method="post"
          action="{% url 'operations_toggle' %}"
          class="checklist-item"
          data-checklist-form
          hx-post="{% url 'operations_toggle' %}"
          hx-trigger="change"
          hx-target="#operations-dynamic"
          hx-swap="innerHTML"
        >
          {% csrf_token %}
          <input type="hidden" name="item_key" value="{{ item.key }}">
          <label>
            <input type="checkbox" name="checked" {% if item.checked %}checked{% endif %} data-checklist-input>
            <span>{{ item.label }}</span>
          </label>
          {% if item.help %}
            <small>{{ item.help }}</small>
          {% endif %}
          <noscript>
            <button type="submit" class="secondary outline">Update</button>
          </noscript>
        </form>
      {% else %}
        <div class="checklist-item checklist-item-readonly" data-tooltip="Sign in to update this checklist item.">
          <label>
            <input type="checkbox" {% if item.checked %}checked{% endif %} disabled>
            <span>{{ item.label }}</span>
          </label>
          {% if item.help %}
            <small>{{ item.help }}</small>
          {% endif %}
        </div>
      {% endif %}
    {% endfor %}
  </div>
</section>

<section class="section">
  <h3>Actions</h3>
  <div class="operations-actions">
    {% if request.user.is_authenticated %}
      <form
        method="post"
        action="{% url 'operations_open' %}"
        hx-post="{% url 'operations_open' %}"
        hx-target="#operations-dynamic"
        hx-swap="innerHTML"
      >
        {% csrf_token %}
        <button type="submit" {% if not all_checked %}disabled{% endif %}>Open observatory</button>
      </form>
      <form
        method="post"
        action="{% url 'operations_close' %}"
        hx-post="{% url 'operations_close' %}"
        hx-target="#operations-dynamic"
        hx-swap="innerHTML"
      >
        {% csrf_token %}
        <button type="submit" class="secondary">Close observatory</button>
      </form>
    {% else %}
      <button type="button" class="secondary" disabled data-tooltip="Sign in to trigger observatory actions.">Open observatory</button>
      <button type="button" class="secondary" disabled data-tooltip="Sign in to trigger observatory actions.">Close observatory</button>
    {% endif %}
  </div>
  {% if not request.user.is_authenticated %}
    <div class="operations-note">Sign in to update the checklist or trigger observatory actions.</div>
  {% endif %}
  {% if not all_checked %}
    <div class="operations-note">Complete the checklist to enable opening.</div>
  {% endif %}
  {% if not controller_configured %}
    <div class="operations-note">Controller API is not configured. Actions will be recorded locally only.</div>
  {% endif %}
</section>
